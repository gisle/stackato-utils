#!/usr/bin/perl

use strict;
use Getopt::Long qw(GetOptions);
use ActiveState::Browser ();
use ActiveState::Path qw(find_prog);

GetOptions() || usage();
my $appname = shift || usage();
usage() if @ARGV;

my $stackato = find_prog("stackato");
die "Can't find the stackato client program" unless $stackato;

# There is no way to directly look up the uris for a given app
use JSON qw(decode_json);
my $apps = decode_json(scalar qx($stackato apps --json));
for my $app (@$apps) {
    if ($app->{name} eq $appname) {
	my $uri = $app->{uris}[0];
	$uri = "http://" . $uri unless $uri =~ s/^https?://;
	ActiveState::Browser::open($uri);
	exit;
    }
}

die "No app named '$appname'; known apps are " . join(", ", map $_->{name}, @$apps) . "\n";

sub usage {
    (my $progname = $0) =~ s,.*/,,;
    die "Usage: $progname <appname>\n";
}
